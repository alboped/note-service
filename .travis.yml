sudo: false
language: node_js
node_js:
  - '10'
before_install:
  - npm i npminstall -g
install:
  - npminstall
script:
  - npm run ci
after_script:
  - npminstall codecov && codecov
after_success:
  - npm prune --production
  - tar -jcf note-service.tar.bz2 *
  - scp note-service.tar.bz2 ${note_server_username}@${note_server_host}:/home/app/
  - ssh ${note_server_username}@${note_server_host} 'mkdir -p note-service && tar -jxf note-service.tar.bz2 -C note-service'
  - ssh ${note_server_username}@${note_server_host} 'cd note-service && yarn stop && yarn start'